<!DOCTYPE html>
<html lang="ru">

<head>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!--    <link rel="apple-touch-icon" sizes="180x180" href="{{ url_for('static', filename='apple-touch-icon.png') }}">-->
    <!--<link rel="icon" type="image/png" sizes="32x32" href="{{ url_for('static', filename='favicon-32x32.png') }}">-->
    <!--<link rel="icon" type="image/png" sizes="16x16" href="{{ url_for('static', filename='favicon-16x16.png') }}">-->
    <!--<link rel="manifest" href="{{ url_for('static', filename='manifest.json') }}">-->
    <!--<link rel="icon" href="{{ url_for('static', filename='favicon.ico') }}" type="image/x-icon">-->
    <!--<meta name="theme-color" content="#0f0f0f">-->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}–°–∞–π—Ç{% endblock %}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body>
    <!-- Yandex.Metrika counter -->
    <script type="text/javascript">
        (function (m, e, t, r, i, k, a) {
            m[i] = m[i] || function () { (m[i].a = m[i].a || []).push(arguments) };
            m[i].l = 1 * new Date();
            for (var j = 0; j < document.scripts.length; j++) { if (document.scripts[j].src === r) { return; } }
            k = e.createElement(t), a = e.getElementsByTagName(t)[0], k.async = 1, k.src = r, a.parentNode.insertBefore(k, a)
        })(window, document, 'script', 'https://mc.yandex.ru/metrika/tag.js?id=106045812', 'ym');

        ym(106045812, 'init', { ssr: true, webvisor: true, clickmap: true, ecommerce: "dataLayer", accurateTrackBounce: true, trackLinks: true });
    </script>
    <noscript>
        <div><img src="https://mc.yandex.ru/watch/106045812" style="position:absolute; left:-9999px;" alt="" /></div>
    </noscript>
    <!-- /Yandex.Metrika counter -->
    <header>
        <div class="header-content">
            <nav>
                {% block navigation %}
                <a href="{{ url_for('index') }}">–ì–ª–∞–≤–Ω–∞—è</a>
                <a href="{{ url_for('comments') }}">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏</a>
                {% endblock %}
                <!-- –°–∫—Ä—ã—Ç–∞—è –Ω–µ–≤–∏–¥–∏–º–∞—è –∫–Ω–æ–ø–∫–∞ –∞–¥–º–∏–Ω–∞ -->
                <span id="admin-toggle-btn" onclick="toggleAdminMode()"
                    style="position: fixed; top: 10px; right: 80px; width: 20px; height: 20px; opacity: 0; cursor: pointer; z-index: 1000;"></span>
            </nav>
            <div class="auth-buttons">
                {% if session.user_id %}
                <!-- –ü—Ä–æ—Ñ–∏–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
                <div class="user-profile">
                    {% set user = get_user(session.user_id) %}
                    {% if user %}
                    {% if user.avatar %}
                    {% if user.avatar.startswith('http') or user.avatar.startswith('/') %}
                    <img src="{{ user.avatar }}" alt="{{ user.nickname }}" class="profile-avatar"
                        title="{{ user.nickname }}">
                    {% else %}
                    <img src="{{ url_for('static', filename='images/' + user.avatar) }}" alt="{{ user.nickname }}"
                        class="profile-avatar" title="{{ user.nickname }}">
                    {% endif %}
                    {% else %}
                    <div class="profile-avatar-default" style="background: linear-gradient(135deg, #4a90e2, #8a2be2);"
                        title="{{ user.nickname }}">
                        <i class="fas fa-user"></i>
                    </div>
                    {% endif %}
                    {% endif %}
                </div>
                <!-- –ü—Ä—è–º–æ–π –∫–ª–∏–∫ –ø–æ –∞–≤–∞—Ç–∞—Ä—É –≤—ã–ø–æ–ª–Ω—è–µ—Ç –≤—ã—Ö–æ–¥ –∏ –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤—Ö–æ–¥–∞ -->
                {% else %}
                <!-- –ö–Ω–æ–ø–∫–∞ –ª–æ–≥–∏–Ω–∞ –¥–ª—è –Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö -->
                {% block auth_buttons %}
                {% endblock %}
                {% endif %}
            </div>
        </div>
    </header>

    {% block side_icons %}{% endblock %}

    <div class="container">
        {% block content %}{% endblock %}
    </div>

    {% block scripts %}{% endblock %}

    <script>
        // –°–∫—Ä—ã—Ç–∞—è –ª–æ–≥–∏–∫–∞ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ —Ä–µ–∂–∏–º–∞ –∞–¥–º–∏–Ω–∞
        let adminClickCount = 0;
        let adminClickTimer = null;
        const ADMIN_CLICK_THRESHOLD = 7;  // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–ª–∏–∫–æ–≤ –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏
        const ADMIN_CLICK_TIMEOUT = 2000; // –¢–∞–π–º–∞—É—Ç –º–µ–∂–¥—É –∫–ª–∏–∫–∞–º–∏ (–º—Å)

        // –ì–ª–æ–±–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ä–µ–∂–∏–º–∞ –∞–¥–º–∏–Ω–∞
        function toggleAdminMode() {
            adminClickCount++;

            // –û—á–∏—â–∞–µ–º —Å—Ç–∞—Ä—ã–π —Ç–∞–π–º–µ—Ä
            if (adminClickTimer) clearTimeout(adminClickTimer);

            // –ï—Å–ª–∏ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∫–ª–∏–∫–æ–≤ - –∞–∫—Ç–∏–≤–∏—Ä—É–µ–º —Ä–µ–∂–∏–º –∞–¥–º–∏–Ω–∞
            if (adminClickCount >= ADMIN_CLICK_THRESHOLD) {
                activateAdminMode();
                adminClickCount = 0;
            } else {
                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–∞–π–º–µ—Ä –¥–ª—è —Å–±—Ä–æ—Å–∞ —Å—á—ë—Ç—á–∏–∫–∞
                adminClickTimer = setTimeout(() => {
                    adminClickCount = 0;
                }, ADMIN_CLICK_TIMEOUT);
            }
        }

        function activateAdminMode() {
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ñ–ª–∞–≥ –∞–¥–º–∏–Ω–∞ –≤ sessionStorage
            sessionStorage.setItem('isAdminMode', 'true');
            console.log('üîì –†–µ–∂–∏–º –∞–¥–º–∏–Ω–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω!');
            alert('–†–µ–∂–∏–º –∞–¥–º–∏–Ω–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω!');
            // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É, –µ—Å–ª–∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤
            if (window.location.pathname.includes('comments')) {
                location.reload();
            }
        }

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∂–∏–º –∞–¥–º–∏–Ω–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function () {
            const isAdminMode = sessionStorage.getItem('isAdminMode') === 'true';
            if (isAdminMode) {
                document.body.classList.add('admin-mode-active');
                console.log('‚úÖ –†–µ–∂–∏–º –∞–¥–º–∏–Ω–∞ –∞–∫—Ç–∏–≤–µ–Ω');
            }

            // –ü—Ä—è–º–æ–π –∫–ª–∏–∫ –ø–æ –∞–≤–∞—Ç–∞—Ä—É: –≤—ã–π—Ç–∏ –∏ –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤—Ö–æ–¥–∞/—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
            const avatar = document.querySelector('.profile-avatar') || document.querySelector('.profile-avatar-default');
            if (avatar) {
                avatar.addEventListener('click', function (e) {
                    e.preventDefault();
                    // –ü–µ—Ä–µ–π–¥—ë–º –Ω–∞ /switch_account, –º–∞—Ä—à—Ä—É—Ç –æ—á–∏—â–∞–µ—Ç —Å–µ—Å—Å–∏—é –∏ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∏—Ç –Ω–∞ /social_login
                    window.location.href = '/switch_account';
                });
            }
        });
    </script>
</body>

</html>